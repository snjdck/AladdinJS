
const ChromeSerial = require('./ChromeSerial');
const {TaskQueue} = require('utils/task');

class Serial extends ChromeSerial
{
	constructor(){
		super();
		this.sendQueue = TaskQueue();
		this.logEnabled = true;
		this.on('data', data => this.logEnabled && this.emit('log', data));
	}

	queueDo(fn){
		return this.sendQueue(async() => this.isConnected() ? fn() : undefined);
	}

	async silentWait(task){
		try{
			this.logEnabled = false;
			return await task;
		}finally{
			this.logEnabled = true;
		}
	}

	async connect(port, bitrate=115200){
		await super.connect(port, bitrate);
		await this.setControlSignals({dtr:false,rts:false});
	}
}

module.exports = Serial;