'use strict';

const shell = fn => (...args) => new Promise((resolve, reject) => {
	const input = document.createElement('input');
	for(let [k, v] of Object.entries(fn(...args))){
		if(v == null)continue;
		input.setAttribute(k, v);
	}
	const multiple = input.getAttribute('multiple') != null;
	input.setAttribute('type', 'file');
	input.addEventListener('change', () => resolve(multiple ? Array.from(input.files, v => v.path) : input.value));
	input.addEventListener('cancel', () => reject());
	input.click();
});

const chooseFile = shell((accept, nwworkingdir) => ({accept, nwworkingdir}));
const chooseFileList = shell((accept, nwworkingdir) => ({accept, nwworkingdir, multiple:''}));
const saveAs = shell((nwsaveas='', accept, nwworkingdir) => ({nwsaveas, accept, nwworkingdir}));
const chooseDirectory = shell((nwworkingdir) => ({nwworkingdir, nwdirectory:''}));

exports.chooseFile = chooseFile;
exports.chooseFileList = chooseFileList;
exports.saveAs = saveAs;
exports.chooseDirectory = chooseDirectory;
