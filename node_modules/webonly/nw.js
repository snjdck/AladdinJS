'use strict';

const shell = fn => (...args) => new Promise((resolve, reject) => {
	const input = document.createElement('input');
	const cwd = fn(input, ...args);
	const multiple = input.getAttribute('multiple') != null;
	if(cwd)input.setAttribute('nwworkingdir', cwd);
	input.setAttribute('type', 'file');
	input.addEventListener('change', () => resolve(multiple ? Array.from(input.files, v => v.path) : input.value));
	input.addEventListener('cancel', () => reject());
	input.click();
});

const chooseFile = shell((input, accept, cwd) => input.setAttribute('accept', accept) || cwd);
const chooseFileList = shell((input, accept, cwd) => input.setAttribute('accept', accept) || input.setAttribute('multiple', '') || cwd);
const saveAs = shell((input, name='', cwd) => input.setAttribute('nwsaveas', name) || cwd);
const chooseDirectory = shell((input, cwd) => input.setAttribute('nwdirectory', '') || cwd);

exports.chooseFile = chooseFile;
exports.chooseFileList = chooseFileList;
exports.saveAs = saveAs;
exports.chooseDirectory = chooseDirectory;
