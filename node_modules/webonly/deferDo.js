'use strict';

const factory = requestFn => handler => {
	const itemSet = new Set();
	function callback(){
		handler(itemSet);
		itemSet.clear();
	}
	return function(item){
		if(itemSet.size <= 0){
			requestFn(callback);
		}
		itemSet.add(item);
	}
}

exports.idleDo = factory(requestIdleCallback);
exports.nextFrameDo = factory(requestAnimationFrame);
exports.deferDo = factory(queueMicrotask);
