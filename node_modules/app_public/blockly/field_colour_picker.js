'use strict';

Blockly.fieldRegistry.register('field_colour_picker', class extends Blockly.FieldTextInput {
	static fromJson(options){
		return new this(options['value'], options);
	}

	constructor(opt_value, opt_config){
		super(opt_value, null, opt_config);
	}

	configure_(config){
		super.configure_(config);
		this.spellcheck_ = false;
		this._markers = config.markers ?? [];
	}

	initView(){
		this.createBorderRect_();
		this.borderRect_.style['fillOpacity'] = 1;
	}

	applyColour(){
		if(!this.borderRect_)return;
		this.borderRect_.style.fill = this.getValue();
	}

	doValueUpdate_(newValue){
		this.value_ = newValue;
		this.applyColour();
	}

	widgetCreate_(){
		const htmlInput = super.widgetCreate_();
		htmlInput.setAttribute('type', 'color');
		htmlInput.style.opacity = 0;
		return htmlInput;
	}

	updateSize_(){
		super.updateSize_(16);
	}

	showInlineEditor_(quietInput){
		super.showInlineEditor_(quietInput);
		if(!quietInput)this.htmlInput_.click();
	}
});

