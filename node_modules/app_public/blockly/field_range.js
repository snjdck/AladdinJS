'use strict';

Blockly.fieldRegistry.register('field_range', class extends Blockly.Field {
	static fromJson({value=0, min=0, max=100, step=1}) {
		let result = new this(value);
		result.min = min;
		result.max = max;
		result.step = step;
		return result;
	}

	constructor(value){
		super(value);
		this.SERIALIZABLE = true;
	}

	showEditor_(){
		Blockly.DropDownDiv.hideWithoutAnimation();
		Blockly.DropDownDiv.clearContent();
		const root = Blockly.DropDownDiv.getContentDiv();

		const datalist = document.createElement('datalist');
		for(let i of [-255, -200, -150, -100, -50, 0, 50, 100, 150, 200, 255]){
			let option = document.createElement('option')
			option.setAttribute('value', i)
			datalist.appendChild(option);
		}

		const range = document.createElement('input');
		range.style.width = '200px';
		range.setAttribute('type', 'range');
		range.setAttribute('min', this.min);
		range.setAttribute('max', this.max);
		range.setAttribute('step', this.step);
		range.setAttribute('value', this.getValue());
		range.addEventListener('change', evt => this.setValue(evt.target.valueAsNumber));

		datalist.setAttribute('id', 'tickmarks');
		range.setAttribute('list', 'tickmarks');

		root.appendChild(datalist);
		root.appendChild(range);

		const block = this.getSourceBlock();
		Blockly.DropDownDiv.setColour(block.getColour(), block.getColourTertiary());
		Blockly.DropDownDiv.showPositionedByField(this);
	}
});

