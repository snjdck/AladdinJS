'use strict';

function createElement(newFn){
	const stack = [[]];
	const addChild = child => stack[stack.length-1].push(child);
	const tag = (type, props) => stack.push([type, props]);
	const end = (type) => {
		const args = stack.pop();
		console.assert(!type || type === args[0]);
		addChild(newFn(...args));
	}
	return factory => function(){
		const layer = stack.length-1;
		const index = stack[layer].length;
		factory.call(this, tag, end, addChild);
		console.assert(layer + 1 === stack.length);
		console.assert(index + 1 === stack[layer].length);
		return stack[layer].pop();
	}
}

exports.createElement = createElement;

