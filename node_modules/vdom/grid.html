<style>
body{
	margin: 0;
}
.table {
	align-items: center;
	justify-items: center;
	display: grid;
}
.table>* {
	border: 1px groove;
	width: 100%;
	height: 100%;
	display: flex;
	align-items: center;
	justify-content: center;
}
.table>:first-child {
	background-color: white;

	z-index: 1;

	position: sticky;
	top:0px;
	left:0px;
}
.table>.row {
	background-color: burlywood;

	position: sticky;
	top:0px;

	margin: 0 1rem;
}
.table>.column {
	background-color: burlywood;

	position: sticky;
	left:0px;
}
</style>

<script>

const columns = ['A','B','C','D','E','F','G','H','I','A','B','C','D','E','F','G','H','I'];
const rows = ['sound','light','sound','light','sound','light','sound','light','sound','light','sound','light','sound','light','sound','light','sound','light','sound','light','sound','light','sound','light','sound','light','sound','light','sound','light','sound','light'];
const values = rows.map(v => columns.map(() => false));

function onInit(){
	const div = document.createElement('div');
	div.setAttribute('class', 'table');
	div.setAttribute('style', `grid-template-columns: 100px repeat(${columns.length}, max-content);grid-auto-rows: 50px;`);
	document.body.appendChild(div);

	div.appendChild(document.createElement('div'));
	for(let i=0; i<columns.length; ++i){
		let child = div.appendChild(document.createElement('div'));
		child.setAttribute('class', 'row');
		child.textContent = columns[i];
	}
	for(let j=0; j<rows.length; ++j){
		let child = div.appendChild(document.createElement('div'));
		child.setAttribute('class', 'column');
		child.textContent = rows[j];
		for(let i=0; i<columns.length; ++i){
			child = div.appendChild(document.createElement('div'));
			let input = child.appendChild(document.createElement('input'));
			input.setAttribute('type', 'checkbox');
			input.addEventListener('change', evt => values[j][i] = evt.target.checked);
		}
	}
}

async function saveFile(name, data){
	let handler = await showSaveFilePicker({
		excludeAcceptAllOption:true,
		id:'save',
		startIn:'documents',
		suggestedName:name,
		types:[{accept:{'application/json':['.json']}}]
	});
	let stream = await handler.createWritable();
	try{
		await stream.write(data);
	}finally{
		await stream.close();
	}
}

async function openFile(){
	let [handler] = await showOpenFilePicker({
		excludeAcceptAllOption:true,
		id:'open',
		startIn:'documents',
		types:[{accept:{'application/json':['.json']}}]
	});
	let file = await handler.getFile();
	return JSON.parse(await file.text());
}


document.addEventListener('DOMContentLoaded', onInit);
window.addEventListener('keyup', async evt => {
	if(evt.repeat)return;
	if(evt.code == 'KeyA'){
		saveFile('data.json', 'okok').then(() => alert('保存成功'))
		return;
	}
	if(evt.code == 'KeyB'){
		console.log(await openFile())
		return;
	}
})
</script>