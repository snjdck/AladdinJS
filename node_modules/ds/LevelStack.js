'use strict';

const {createListGetter} = require('../utils/cache');

const newArray = () => [];

class LevelStack
{
	#stack = createListGetter(newArray);
	#level = 0;
	#depth = 0;

	next(){
		++this.#level;
		this.#depth = Math.max(this.#depth, this.#level);
	}

	prev(){
		--this.#level;
	}

	push(value){
		this.#stack(this.#level).push(value);
	}

	clear(){
		for(let i=this.#depth; i>=0; --i){
			this.#stack(i).length = 0;
		}
		this.#depth = this.#level = 0;
	}

	*[Symbol.iterator](){
		for(let i=this.#depth; i>=0; --i){
			yield this.#stack(i);
		}
	}
}

module.exports = LevelStack;
