"use strict";

const RenderTarget = require("./RenderTarget");

class TextureRenderTarget extends RenderTarget{
	onDispose(gl){
		gl.deleteTexture(this.colorBuffer);
		gl.deleteRenderbuffer(this.depthBuffer);
		this.colorBuffer = null;
		this.depthBuffer = null;
	}

	onCreate(gl){
		this.colorBuffer = gl.createTexture();
		this.depthBuffer = gl.createRenderbuffer();
		
		gl.bindTexture(gl.TEXTURE_2D, this.colorBuffer);
		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
		gl.bindTexture(gl.TEXTURE_2D, null);

		gl.bindRenderbuffer(gl.RENDERBUFFER, this.depthBuffer);
		gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_STENCIL, this.width, this.height);
		gl.bindRenderbuffer(gl.RENDERBUFFER, null);

		this.attachTexture2D(gl, gl.COLOR_ATTACHMENT0, this.colorBuffer);
		this.attachRenderbuffer(gl, gl.DEPTH_STENCIL_ATTACHMENT, this.depthBuffer);
	}
}

module.exports = TextureRenderTarget;