"use strict";

const RenderTarget = require("./RenderTarget");

class DepthRenderTarget extends RenderTarget{
	onDispose(gl){
		gl.deleteTexture(this.depthBuffer);
		this.depthBuffer = null;
	}

	onCreate(gl){
		this.depthBuffer = gl.createTexture();
		
		gl.bindTexture(gl.TEXTURE_2D, this.depthBuffer);
		gl.texImage2D(gl.TEXTURE_2D, 0, gl.DEPTH_COMPONENT32F, this.width, this.height, 0, gl.DEPTH_COMPONENT, gl.FLOAT, null);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
		//gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);
		//gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_FUNC, gl.LEQUAL);
		gl.bindTexture(gl.TEXTURE_2D, null);

		this.attachTexture2D(gl, gl.DEPTH_ATTACHMENT, this.depthBuffer);
	}
}

module.exports = DepthRenderTarget;