"use strict";

const Material = require("./Material");

class TextureMaterial extends Material{
	constructor(texture){
		super("shader3d&normal");
		this.texture = texture;
	}

	onActiveState(gl){
		gl.enable(gl.DEPTH_TEST);
		gl.depthMask(true);
		gl.depthFunc(gl.LEQUAL);
		gl.enable(gl.BLEND);
	}

	onActiveUniform(gl, camera, program){
		let screenAddress = gl.getUniformLocation(program, "screenMatrix");
		gl.uniformMatrix4fv(screenAddress, false, camera.lens);

		let cameraAddress = gl.getUniformLocation(program, "cameraMatrix");
		camera.worldTransformInvert.upload(gl, cameraAddress);

		this.boneListAddress = gl.getUniformLocation(program, "boneList");

		gl.activeTexture(gl.TEXTURE0);
		gl.uniform1i(gl.getUniformLocation(program, "sampler0"), 0);
	}

	onDraw(gl, {material, boneMatrixList}){
		gl.bindTexture(gl.TEXTURE_2D, material.texture);
		gl.uniform4fv(this.boneListAddress, boneMatrixList);
	}
}

module.exports = TextureMaterial;