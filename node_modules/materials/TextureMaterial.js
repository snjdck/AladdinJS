"use strict";

const Material = require("./Material");
const {RenderState} = require("../renderers");

class TextureMaterial extends Material{
	constructor(texture){
		super("shader3d&normal");
		this.texture = texture;
		this.renderState = RenderState.Texture;
	}

	onActiveUniform(gl, camera, program){
		let {uniformBuffer} = gl.render3d;

		uniformBuffer.active(gl);

		uniformBuffer.setFloatv(0, camera.lens);
		camera.worldTransformInvert.copyToArray(uniformBuffer.floatView, 16);
	}

	onActiveVAO(gl, {vao:{bindCount, boneCount}}){
		let {uniformBuffer} = gl.render3d;
		uniformBuffer.setInts(25, bindCount, boneCount);
	}

	onDraw(uniformBuffer, {boneMatrixList}, index){
		uniformBuffer.setFloatv(28 + index * boneMatrixList.length, boneMatrixList);
	}
}

module.exports = TextureMaterial;