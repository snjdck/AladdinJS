"use strict";

const Material = require("./Material");

class TerrainMaterial extends Material{
	constructor(texture){
		super("terrain/");
		this.texture = texture;
	}

	onActiveState(gl){
		gl.enable(gl.DEPTH_TEST);
		gl.depthMask(true);
		gl.depthFunc(gl.LEQUAL);
		gl.enable(gl.BLEND);
	}

	onActiveUniform(gl, camera, program){
		let {uniformBuffer} = gl.render3d;

		uniformBuffer.active(gl);

		uniformBuffer.setFloatv(0, camera.lens);
		camera.worldTransformInvert.copyToArray(uniformBuffer.floatView, 16);
		
		gl.activeTexture(gl.TEXTURE0);
		gl.uniform1i(gl.getUniformLocation(program, "sampler0"), 0);
	}

	onActiveVAO(gl, drawUnit){
		let {uniformBuffer} = gl.render3d;
		uniformBuffer.setFloats(25, drawUnit.size);
	}

	onDraw(uniformBuffer, drawUnit, index){
		uniformBuffer.setFloats(28 + index * 4, drawUnit.tileX, drawUnit.tileY);
	}
}

module.exports = TerrainMaterial;