'use strict';

const Vulkan = require('../Vulkan');
const View3D = require('./View3D');
const Bitmap3DCollector = require('./Bitmap3DCollector');
const Filter2DCollector = require('./Filter2DCollector');

const renderPassDesc = {
	colorAttachments: [{
		attachment: null,
		loadValue: 'load'
	}]
};

module.exports = function(){
	const view3d = new View3D();
	view3d.registerDrawer2D(Bitmap3DCollector());
	view3d.registerDrawer2D(Filter2DCollector());
	view3d.registerDrawer2D(function(root){
		renderPassDesc.colorAttachments[0].attachment = Vulkan.mainColorTexture;
		Vulkan.renderPassEncoder = Vulkan.commandEncoder.beginRenderPass(renderPassDesc);
		Vulkan.viewportMgr.addViewPort(Vulkan.canvas);
		Vulkan.viewportMgr.collectDrawUnits(root);
		Vulkan.viewportMgr.draw();
		Vulkan.renderPassEncoder.endPass();
	});
	return view3d;
}
