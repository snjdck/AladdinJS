'use strict';

const mixin = require('utils/function/mixin');

module.exports = mixin({
	hasAttachment(){
		const {attachmentDict} = this;
		return attachmentDict && attachmentDict.size > 0;
	},
	bindObjectToBone(boneName, target, clearOtherObjects=true){
		if(!this.attachmentDict){
			this.attachmentDict = new Map();
		}
		if(clearOtherObjects)this.unbindObjects(boneName);
		this.attachmentDict.set(target, this.rootBone.getBoneID(boneName));
	},
	unbindObject(target){
		if(!this.hasAttachment())return;
		this.attachmentDict.delete(target);
	},
	unbindObjects(boneName){
		if(!this.hasAttachment())return;
		const {attachmentDict} = this;
		if(boneName == null){
			attachmentDict.clear();
			return;
		}
		const boneID = this.rootBone.getBoneID(boneName);
		for(const [attachment, id] of attachmentDict){
			if(id != boneID)continue;
			attachmentDict.delete(attachment);
		}
	},
});
