'use strict';

const Vulkan = require('../Vulkan');
const ObjectCache = require('utils/ObjectCache');

function Camera3DGPUResourceManager(){
	const cache = new ObjectCache(() => {
		const {device} = Vulkan;

		const uniformBuffer = device.createBuffer({
			size: 7 * 4 * 4,
			usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST
		});

		const mvpBindGroup = Vulkan.createBindGroup(
			Vulkan.layout_0, [
			{buffer: uniformBuffer},
			Vulkan.sampler_linear_repeat
		]);

		const cullBindGroup = Vulkan.createBindGroup(
			Vulkan.layout_2, [
			{buffer: uniformBuffer}
		]);

		return {
			uniformBuffer,
			mvpBindGroup,
			cullBindGroup,
		}
	});
	return {
		onFrameBegin: () => cache.putAllIn(),
		getOut: () => cache.getOut(),
	}
}

module.exports = Camera3DGPUResourceManager;
