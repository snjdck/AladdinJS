'use strict';

const WebGL = require('../WebGL');
const {decode} = require('fileformats/images');
const {createFetch} = require('utils/cache');
const {loadAll} = require('utils/loadAll');

class TextureManager{
	constructor(){
		this.fetch = createFetch(this.doLoad);
		this.fetchAll = loadAll.bind(null, this.fetch, 10);
	}

	doLoad(name, callback){
		const {assetMgr, gl, createTexture} = WebGL;
		if(name.endsWith(".tga")){
			assetMgr.loadFile(name).then(data => {
				let image = decode(name, data);
				let texture = createTexture(image.width, image.height, image.data);
				texture.transparent = true;
				texture.name = name;
				callback(texture);
			});
		}else{
			assetMgr.loadImage(name).then(image => {
				let texture = createTexture(image.width, image.height, image, false);
				texture.transparent = false;
				texture.name = name;
				callback(texture);
			});
		}
	}
}

module.exports = TextureManager;
