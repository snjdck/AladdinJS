'use strict';

const ClassifierFactory = require('./helper/ClassifierFactory');

const classifyMaterial = ClassifierFactory(drawUnit => drawUnit.material.constructor, ([a], [b]) => a.order - b.order);
const classifyMesh = ClassifierFactory(drawUnit => drawUnit.entity.mesh);

class DrawUnitBucket
{
	constructor(){
		this.list = [];
	}

	add(element){
		this.list.push(element);
	}

	length(){
		return this.list.length;
	}

	clear(){
		this.list.length = 0;
	}

	draw(){
		for(const [materialType, entityList] of classifyMaterial(this.list)){
			if(!materialType.useMeshFlag){
				materialType.draw(entityList);
				continue;
			}
			for(const [mesh, subEntityList] of classifyMesh(entityList)){
				materialType.draw(subEntityList, mesh);
			}
		}
		return this;
	}
}

module.exports = DrawUnitBucket;
