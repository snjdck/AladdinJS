'use strict';

const Vulkan = require('../../Vulkan');
const UniformBufferSlotCache = require('../../helper/UniformBufferSlotCache');

const {delayNew} = require('utils/cache');

module.exports = bindIndex => delayNew(() => {
	const buffer = new Float32Array(7);
	const slot = new UniformBufferSlotCache(
		Vulkan.bindGroupLayoutDict.bindGroupLayout2Dynamic,
		256,
		drawUnit => {
			const {bound} = drawUnit.material;
			buffer[0] = bound.minX;
			buffer[1] = bound.minY;
			buffer[2] = bound.minZ;
			buffer[4] = bound.maxX;
			buffer[5] = bound.maxY;
			buffer[6] = bound.maxZ;
			return buffer;
		}
	);
	Vulkan.events.addEventListener('update', () => slot.clear());
	return slot;
})().bind(bindIndex);
