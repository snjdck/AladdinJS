'use strict';

const Vulkan = require('../../Vulkan');
const SlotCache = require('../../helper/SlotCache');

const {delayNew} = require('utils/cache');

const objectBuffer3D = new Float32Array(256*4);

module.exports = delayNew(() => {
	const slot = new SlotCache(
		Vulkan.bindGroupLayoutDict.bindGroupLayout2Dynamic,
		4,
		objectBuffer3D.byteLength,
		instance => (
			instance.skeleton?.rootBone?.copyToBuffer(objectBuffer3D),
			objectBuffer3D
		)
	);
	Vulkan.events.addEventListener('update', () => slot.clear());
	return slot;
});
