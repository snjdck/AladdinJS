'use strict';

let glslang;

exports.init = async function(){
	//const glslangModule = await import('https://unpkg.com/@webgpu/glslang@0.0.7/web/glslang.js');
	//const glslangModule = await import('https://unpkg.com/@webgpu/glslang@0.0.15/dist/web-devel/glslang.js');
	const glslangModule = await import('./glslang.js');
	glslang = await glslangModule.default();
}

exports.compile = function(mod, vertex='vertexCode', fragment='fragmentCode'){
	let vertexCode = mod[vertex].indexOf('#version 450') < 0 ? mod[vertex] : glslang.compileGLSL(mod[vertex], "vertex");
	let fragmentCode = mod[fragment].indexOf('#version 450') < 0 ? mod[fragment] : glslang.compileGLSL(mod[fragment], "fragment");
	return {vertexCode, fragmentCode};
}

exports.compute = function(mod, key){
	return glslang.compileGLSL(key ? mod[key] : mod, "compute");
}
