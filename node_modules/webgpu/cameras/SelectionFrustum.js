'use strict';

const ViewFrustum = require('./ViewFrustum');

class SelectionFrustum extends ViewFrustum
{
	constructor(){
		super();
	}

	canCull(aabb){
		if(super.canCull(aabb))return true;
		const {planeList} = this;
		const {minX, minY, minZ, maxX, maxY, maxZ} = aabb;
		return !(
			isPointIn(planeList, minX, minY, minZ) ||
			isPointIn(planeList, maxX, minY, minZ) ||
			isPointIn(planeList, minX, maxY, minZ) ||
			isPointIn(planeList, maxX, maxY, minZ) ||
			isPointIn(planeList, minX, minY, maxZ) ||
			isPointIn(planeList, maxX, minY, maxZ) ||
			isPointIn(planeList, minX, maxY, maxZ) ||
			isPointIn(planeList, maxX, maxY, maxZ)
		);
	}
}

function isPointIn(planeList, x, y, z){
	for(const [a, b, c, d] of planeList){
		if(a * x + b * y + c * z + d < 0)return false;
	}
	return true;
}

module.exports = SelectionFrustum;
