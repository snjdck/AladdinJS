const defineConstGetter = require('utils/object/defineConstGetter');

function calcWireframeIndex(){
	const rawData = this.index;
	const indexCount = rawData ? rawData.length : this.position.length / 3;
	const indexData = new Uint16Array(indexCount << 1);
	if(rawData){
		for(let i=0; i<indexCount; i+=3){
			indexData.set([rawData[i], rawData[i+1], rawData[i+1], rawData[i+2], rawData[i+2], rawData[i]], i << 1);
		}
	}else{
		for(let i=0; i<indexCount; i+=3){
			indexData.set([i, i+1, i+1, i+2, i+2, i], i << 1);
		}
	}
	return indexData;
}

function initMesh(mesh){
	for(let subMesh of mesh.subMeshList){
		if(!subMesh.attributes)continue;
		defineConstGetter(subMesh.attributes, 'indexWireframe', calcWireframeIndex);
	}
	return mesh;
}

exports.initMesh = initMesh;
