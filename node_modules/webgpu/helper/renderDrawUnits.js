'use strict';

const ClassifierFactory = require('./ClassifierFactory');

const classifyMaterial = ClassifierFactory(drawUnit => drawUnit.material.constructor, ([a], [b]) => a.order - b.order);
const classifyMesh = ClassifierFactory(drawUnit => drawUnit.entity.mesh);

function renderDrawUnits(drawUnitList){
	for(const [materialType, entityList] of classifyMaterial(drawUnitList)){
		if(materialType.useMeshFlag !== true){
			materialType.draw(entityList);
			continue;
		}
		for(const [mesh, subEntityList] of classifyMesh(entityList)){
			materialType.draw(subEntityList, mesh);
		}
	}
}

module.exports = renderDrawUnits;
