'use strict';

const EventEmitter = require('events/index');
const {tickByFrame} = require('webonly/timer');

const targetList = new Set();
const events = new EventEmitter();

function register(target){
	targetList.add(target);
}

function unregister(target){
	targetList.delete(target);
}

function onTick(timeElapsed, timestamp){
	this.timeElapsed = timeElapsed * this.timeScale;
	this.timestamp = timestamp;
	if(this.paused)return;
	events.emit('enterFrame');
	targetList.forEach(target => target.onTick());
	events.emit('exitFrame');
}

exports.events = events;
exports.paused = false;
exports.timeScale = 1;
exports.timestamp = performance.now();
exports.register = register;
exports.unregister = unregister;

exports.on = (evt, fn) => events.on(evt, fn);
exports.off = (evt, fn) => events.off(evt, fn);
exports.once = (evt, fn) => events.once(evt, fn);

tickByFrame(onTick.bind(exports));
