'use strict';

function draw(entityCount, slotList, infoList, bindIndexList, drawFn, ...args){
	const offsetList = new Array(infoList.length).fill(0);
	const indexList = offsetList.slice();
	for(let i=0; i<entityCount;){
		for(let j=infoList.length-1; j>=0; --j){
			if(i < offsetList[j]){
				const [batchIndex, bufferOffset, instanceCount] = infoList[j][indexList[j]-1];
				slotList[j].active(bindIndexList[j], batchIndex, bufferOffset + i - (offsetList[j] - instanceCount));
			}else{
				const [batchIndex, bufferOffset, instanceCount] = infoList[j][indexList[j]++];
				slotList[j].active(bindIndexList[j], batchIndex, bufferOffset);
				offsetList[j] += instanceCount;
			}
		}
		const offsetEnd = Math.min(...offsetList);
		drawFn.call(this, offsetEnd - i, ...args);
		i = offsetEnd;
	}
}

module.exports = draw;
