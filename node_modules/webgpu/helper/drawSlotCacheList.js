'use strict';

function* draw(entityCount, slotList, infoList){
	const slotCount = infoList.length;
	const offsetList = new Array(slotCount).fill(0);
	const indexList = new Array(slotCount).fill(0);
	for(let i=0; i<entityCount;){
		for(let j=0; j<slotCount; ++j){
			if(i < offsetList[j]){
				const [batchIndex, bufferOffset, instanceCount] = infoList[j][indexList[j]-1];
				slotList[j].active(batchIndex, bufferOffset + i - (offsetList[j] - instanceCount));
			}else{
				const [batchIndex, bufferOffset, instanceCount] = infoList[j][indexList[j]++];
				slotList[j].active(batchIndex, bufferOffset);
				offsetList[j] += instanceCount;
			}
		}
		const offsetEnd = Math.min(...offsetList);
		yield [offsetEnd - i, i];
		i = offsetEnd;
	}
}

module.exports = draw;
