'use strict';

const {execSync} = require('child_process');
const path = require('path');
const watchFile = require('./watchFile');

module.exports = function(filename, main='index.js'){
	watchFile(filename, function(){
		let dirtyFlag = false;
		return function(){
			if(dirtyFlag)return;
			dirtyFlag = true;
			setTimeout(function(){
				dirtyFlag = false;
				execSync(`node ${__dirname}/webpack.js ${path.join(filename, main)}`, {
					cwd: filename
				});
			}, 10);
		}
	}());
}
