'use strict';

const {execSync} = require('child_process');
const path = require('path');
const watchFile = require('./watchFile');

module.exports = function(filename, main, output, args=''){
	const build = () => execSync(`node ${__dirname}/webpack.js ${path.join(filename, main)} ${args}`, {cwd: output}).toString();
	watchFile(filename, function(){
		let dirtyFlag = false;
		return function(){
			if(dirtyFlag)return;
			dirtyFlag = true;
			setTimeout(function(){
				dirtyFlag = false;
				console.log('build', build());
			}, 10);
		}
	}());
	console.log('start', build());
}
