'use strict';

const watchFile = require('./watchFile');

module.exports = function(root){
	const socketList = [];
	setInterval(() => socketList.forEach(response => response.write(': ping\n\n')), 30 * 1000);
	watchFile(root, () => socketList.forEach(response => response.write('data: reload\n\n')));
	return response => {
		socketList.push(response);
		return () => socketList.splice(socketList.indexOf(response), 1);
	}
}

/*
	<script>
		let ws = new WebSocket('ws://127.0.0.1:81');
		ws.onmessage = () => location.reload(true);
		ws.onclose = evt => console.log('closed', evt);
		setInterval(() => ws.send('ping'), 30 * 1000);
	</script>
	<script>
		let es = new EventSource('http://127.0.0.1:81');
		es.onmessage = () => location.reload(true);
	</script>
*/
