"use strict";

const trace = console.log;
const formatPrice = v => v * 1e-4 + "万";
const formatDate = v => Math.floor(v/12+1).toString().padEnd(2) + "-" + (v%12+1).toString().padEnd(2);
const formatRate = v => (v * 1000).toFixed(2) + "‰";
const sum = v => v.reduce((a, b) => a + b, 0);

class HousePrice
{
	constructor(price, area, info){
		info = Object.assign({
			yearRate: 0.049,
			numYear: 30,
			firstPayRate: 0.3
		}, info);

		this.monthRate = info.yearRate / 12;
		this.numMonth  = info.numYear  * 12;

		let totalPrice = price * area;
		let loan = totalPrice * (1 - info.firstPayRate);
		trace("total:", formatPrice(totalPrice));
		trace("  pay:", formatPrice(totalPrice * info.firstPayRate));
		trace(" loan:", formatPrice(loan));
		let t0 = Array.from(this.test1());
		let t1 = Array.from(this.test2());

		trace("======", sum(t0), sum(t1));
		//*
		for(let i=0; i<this.numMonth; ++i){
			trace(formatDate(i), "\t", Math.round(t0[i] * loan), "\t", Math.round(t1[i] * loan), "\t", formatRate(t0[i]), formatRate(t1[i]));
		}
		//*/
	}
	
	*test1(){
		const {numMonth, monthRate} = this;
		let monthBase = 1 / numMonth;
		let leftMoney = 1;
		for(let i=0; i<numMonth; ++i){
			yield monthBase + leftMoney * monthRate;
			leftMoney -= monthBase;
		}
	}
	
	*test2(){
		const {numMonth, monthRate} = this;
		let monthBase = monthRate / (Math.pow(1 + monthRate, numMonth) - 1);
		let leftMoney = 1;
		for(var i=0; i<numMonth; ++i){
			yield monthBase + leftMoney * monthRate;
			leftMoney -= monthBase;
			monthBase *= 1 + monthRate;
		}
	}
}

new HousePrice(17, 10000, {
	yearRate: 0.049 * 1.15,
	numYear: 8,
	firstPayRate: 0
});