'use strict';

function createTask(handler, maxCount=1){
	let taskList = [];
	let runCount = 0;
	const doRun = () => taskList.length > 0 && runCount < maxCount && handler(taskList.shift(), ++runCount).then(onRun);
	const onRun = () => doRun(--runCount);
	return task => doRun(taskList.push(task));
}

module.exports = createTask;
