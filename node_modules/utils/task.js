'use strict';

function createTask(handler, maxCount=1){
	let taskList = [];
	let runCount = 0;
	function doRun(){
		if(taskList.length <= 0 || runCount >= maxCount)return;
		++runCount;
		handler(...taskList.shift()).then(onRun);
	}
	const onRun = () => doRun(--runCount);
	return (...args) => doRun(taskList.push(args));
}

module.exports = createTask;
