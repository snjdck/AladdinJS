
const removeLineComments = (pattern => code => code.replace(pattern, ''))(/\/\/.*/g);

function removeBlockComments(code){
	for(;;){
		const i = code.lastIndexOf('/*');
		if(i < 0)break;
		const j = code.indexOf('*/', i+2);
		if(j < 0)break;
		code = code.slice(0, i) + code.slice(j+2);
	}
	return code;
}

function removeComments(code){
	for(;;){
		let v = code.match(/\/[\/*]/);
		if(!v)return code;
		if(v[0] == '//'){
			code = code.replace(/\/\/.*/, '');
		}else{
			code = code.replace(/\/\*.*?\*\//s, '');
		}
	}
}

function removeNestComments(code){
	for(;;){
		let v = code.match(/\/[\/*]/);
		if(!v)return code;
		if(v[0] == '//'){
			code = code.replace(/\/\/.*/, '');
			continue;
		}
		let end = v.index + 2;
		for(let n=1; n>0;){
			let t = code.slice(end).match(/\/\*|\*\//);
			if(!t)return code;
			end += t.index + 2;
			n += t[0] == '/*' ? 1 : -1;
		}
		code = code.slice(0, v.index) + code.slice(end);
	}
}

//exports.removeLineComments = removeLineComments;
//exports.removeBlockComments = removeBlockComments;
exports.removeComments = removeComments;
exports.removeNestComments = removeNestComments;
