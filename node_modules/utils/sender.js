'use strict';

function limitSend(sendFn, data, callback, limit=20){
	if(data.byteLength <= limit)
		return sendFn(data, callback);
	let offset = 0;
	void function doSend(){
		const remain = data.byteLength - offset;
		if(remain <= limit)
			return sendFn(slice(data, offset, remain), callback);
		sendFn(slice(data, offset, limit), doSend, void(offset += limit));
	}();
}

function slice(data, offset, count){
	let list = new Uint8Array(count);
	list.set(new Uint8Array(data, offset, count));
	return list.buffer;
}

exports.limitSend = limitSend;
exports.slice = slice;
