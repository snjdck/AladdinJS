'use strict';

function tokenFactory(getFn){
	let token, expires_at;
	return async task => {
		if(!token || expires_at < performance.now()){
			const info = await getFn();
			token = info[0];
			expires_at = info[1] * 1000 + performance.now();
		}
		return task(token);
	}
}

const wrapTokenFn = (tokenFn, ...fixedArgs) => (fn, ...args) => tokenFn(token => fn?.(token, ...fixedArgs, ...args));

exports.tokenFactory = tokenFactory;
exports.wrapTokenFn = wrapTokenFn;
