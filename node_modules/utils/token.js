'use strict';

function tokenFactory(getFn){
	let token, expires_at;
	return async () => {
		if(!token || expires_at < performance.now()){
			const info = await getFn();
			token = info[0];
			expires_at = info[1] * 1000 + performance.now();
		}
		return token;
	}
}

const wrapTokenFn = (tokenFn, ...fixedArgs) => async (fn, ...args) => fn(await tokenFn(), ...fixedArgs, ...args);

exports.tokenFactory = tokenFactory;
exports.wrapTokenFn = wrapTokenFn;
