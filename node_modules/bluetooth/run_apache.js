'use strict';

const fs = require('fs');
const options = {
	key: fs.readFileSync('./server.key'),
	cert: fs.readFileSync('./server.pem')
};

const autopack = require('../build_tools/autopack');
const autoload = require('../build_tools/autoload');
const compileFn = require('./online_compiler');
const {HttpServer, EventSource, StaticFile, Redirect, Router} = require('../net/HttpServer');

const root = '../app_public';

autopack(__dirname, 'main.js', root, '--debug');

HttpServer({
	protocol: 'https',
	port: 443,
	options
}, [
	EventSource({
		'/reload': autoload(root)
	}),
	Router('POST', {
		'/compile': compileFn,
	}),
	StaticFile(root),
])

HttpServer(null, [
	Redirect(request => 'https://192.168.0.6' + request.url),
])
