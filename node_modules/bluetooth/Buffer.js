'use strict';

if(typeof Buffer == 'undefined'){
	function Buffer(){}
	Buffer.from = list => Uint8Array.from(list);
	Buffer.allocUnsafe = n => new Uint8Array(n);
	Buffer.alloc = n => new Uint8Array(n);
	Buffer.allocUnsafe = n => new Uint8Array(n);
	Buffer.allocUnsafeSlow = n => new Uint8Array(n);
	Buffer.concat = list => {
		let buffer = new Uint8Array(list.reduce((a, b) => a + b.length, 0));
		let offset = 0;
		for(let v of list){
			buffer.set(v, offset);
			offset += v.length;
		}
		return buffer;
	};
	const readUIntLE = function(offset, n){
		let result = 0;
		for(let i=0; i<n; ++i){
			result |= this[offset+i] << (i << 3);
		}
		return result;
	}
	const readUIntBE = function(offset, n){
		let result = 0;
		for(let i=0; i<n; ++i){
			result = result << 8 | this[offset+i];
		}
		return result;
	}
	const readIntLE = function(offset, n){
		return readUIntLE.call(this, offset, n-1) | this.readInt8(offset+n-1) << (n - 1 << 3);
	}
	const readIntBE = function(offset, n){
		return this.readInt8(offset) << (n - 1 << 3) | readUIntBE.call(this, offset+1, n-1);
	}
	Uint8Array.prototype.readUInt32BE = function(offset=0){return readUIntBE.call(this, offset, 4);}
	Uint8Array.prototype.readUInt32LE = function(offset=0){return readUIntLE.call(this, offset, 4);}
	Uint8Array.prototype.readUInt16BE = function(offset=0){return readUIntBE.call(this, offset, 2);}
	Uint8Array.prototype.readUInt16LE = function(offset=0){return readUIntLE.call(this, offset, 2);}
	Uint8Array.prototype.readUInt8 = function(offset=0){return this[offset];}
	Uint8Array.prototype.readInt32BE = function(offset=0){return readIntBE.call(this, offset, 4);}
	Uint8Array.prototype.readInt32LE = function(offset=0){return readIntLE.call(this, offset, 4);}
	Uint8Array.prototype.readInt16BE = function(offset=0){return readIntBE.call(this, offset, 2);}
	Uint8Array.prototype.readInt16LE = function(offset=0){return readIntLE.call(this, offset, 2);}
	Uint8Array.prototype.readInt8 = function(offset=0){
		const value = this[offset];
		return value & 0x80 ? value - 0x100 : value;
	}
	const writeUIntLE = function(v, offset, n){
		for(let i=0; i<n; ++i){
			this[offset+i] = v >> (i << 3) & 0xFF;
		}
		return offset + n;
	}
	const writeUIntBE = function(v, offset, n){
		for(let i=0; i<n; ++i){
			this[offset+i] = v >> (n - i - 1 << 3) & 0xFF;
		}
		return offset + n;
	}
	Uint8Array.prototype.writeUInt32BE = function(v, offset=0){return writeUIntBE.call(this, v, offset, 4);}
	Uint8Array.prototype.writeUInt32LE = function(v, offset=0){return writeUIntLE.call(this, v, offset, 4);}
	Uint8Array.prototype.writeUInt16BE = function(v, offset=0){return writeUIntBE.call(this, v, offset, 2);}
	Uint8Array.prototype.writeUInt16LE = function(v, offset=0){return writeUIntLE.call(this, v, offset, 2);}
	Uint8Array.prototype.writeUInt8 = function(v, offset=0){return writeUIntLE.call(this, v, offset, 1);}
	Uint8Array.prototype.writeInt32BE = Uint8Array.prototype.writeUInt32BE;
	Uint8Array.prototype.writeInt32LE = Uint8Array.prototype.writeUInt32LE;
	Uint8Array.prototype.writeInt16BE = Uint8Array.prototype.writeUInt16BE;
	Uint8Array.prototype.writeInt16LE = Uint8Array.prototype.writeUInt16LE;
	Uint8Array.prototype.writeInt8 = Uint8Array.prototype.writeUInt8;
	Uint8Array.prototype.readFloatBE = function(offset=0){
		return new DataView(this.buffer, offset, 4).getFloat32(0, false);
	}
	Uint8Array.prototype.readFloatLE = function(offset=0){
		return new DataView(this.buffer, offset, 4).getFloat32(0, true);
	}
	Uint8Array.prototype.readDoubleBE = function(offset=0){
		return new DataView(this.buffer, offset, 8).getFloat64(0, false);
	}
	Uint8Array.prototype.readDoubleLE = function(offset=0){
		return new DataView(this.buffer, offset, 8).getFloat64(0, true);
	}
	Uint8Array.prototype.fill = function(value){
		for(let i=0, n=this.length; i<n; ++i){
			this[i] = value;
		}
		return this;
	}
	window.Buffer = Buffer;
}