
const dgram = require('dgram');

const JAN_1970 = 0x83aa7e80;
const NTPFRAC = x => 4294 * x + (1981 * x >> 11);
const USEC = x => (x >> 12) - 759 * (((x >> 10) + 32768) >> 16);

const getTime = () => new Promise(resolve => {
	dgram.createSocket('udp4').on('message', function(msg){
		this.close();
		const result = [];
		for(let i=0; i<12; ++i){
			result.push(msg.readUInt32BE(i << 2));
		}
		console.log(new Date((result[ 4] - JAN_1970) * 1000).toString())
		console.log(new Date((result[ 6] - JAN_1970) * 1000).toString())
		console.log(new Date((result[ 8] - JAN_1970) * 1000).toString())
		console.log(new Date((result[10] - JAN_1970) * 1000).toString())
	}).send(function(){
		const payload = Buffer.alloc(48);
		payload.writeInt32BE((0 << 30) | (3 << 27) | (3 << 24) | (0 << 16) | (4 << 8) | (-6 & 0xFF), 0);
		payload.writeInt32BE(1 << 16, 4);
		payload.writeInt32BE(1 << 16, 8);
		const time = Date.now();
		payload.writeInt32BE((time * 0.001 + JAN_1970) | 0, 40);
		return payload;
	}(), 123, 'time.windows.com');
});

getTime()