
module.exports = function(socket, Packet, dstEvt='packet', srcEvt='data'){
	const onData = (buffer => data => {
		buffer = Buffer.concat([buffer, data]);
		let offset = 0;
		for(;;){
			let packet = Packet.cut(buffer, offset);
			if(!packet)break;
			offset += packet.length;
			socket.emit(dstEvt, Packet.decode(packet));
		}
		if(offset <= 0)return;
		buffer = buffer.slice(offset);
	})(Buffer.alloc(0));
	socket.on(srcEvt, onData);
	return () => socket.off(srcEvt, onData);
}
