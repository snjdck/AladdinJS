
module.exports = function(socket, Packet){
	const onData = (buffer => data => {
		buffer = Buffer.concat([buffer, data]);
		let offset = 0;
		for(;;){
			let packet = Packet.cut(buffer, offset);
			if(!packet)break;
			offset += packet.length;
			socket.emit('packet', Packet.decode(packet));
		}
		if(offset <= 0)return;
		buffer = buffer.slice(offset);
	})(Buffer.alloc(0));
	socket.on('data', onData);
	return () => socket.off('data', onData);
}
