'use strict';

const composeFactory = (concatFn, checkFn, valueFn) => (...args) => data => {
	concatFn(data, ...args);
	if(!checkFn(...args))return false;
	return valueFn ? valueFn(...args) : args[0];
}

async function* listenReadableStream(stream){
	const reader = stream.getReader();
	try{
		for(;;){
			const {done, value} = await reader.read();
			if(done)return;
			yield value;
		}
	}finally{
		reader.releaseLock();
	}
}

async function writeWritableStream(stream, value){
	const writer = stream.getWriter();
	try{
		return await writer.write(value);
	}finally{
		writer.releaseLock();
	}
}

exports.composeFactory = composeFactory;
exports.listenReadableStream = listenReadableStream;
exports.writeWritableStream = writeWritableStream;
