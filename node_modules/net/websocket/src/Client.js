
const EventEmitter = require('events');
const Packet = require('./Packet');
const encode = require('./encode');
const listenPacket = require('net/listenPacket');

function onPacket(data){
	if(data == null)return;
	let evt = (typeof data == 'number') ? 'close' : 'message';
	this.emit(evt, data);
}

class WebSocketClient extends EventEmitter
{
	constructor(socket){
		super();
		this.socket = socket;
		listenPacket(socket, Packet);
		socket.on('packet', onPacket.bind(this));
	}

	send(data){
		this.socket.write(encode(data));
	}
}

module.exports = WebSocketClient;