
const EventEmitter = require('events');
const Packet = require('./Packet');
const encode = require('./encode');
const listenPacket = require('net/listenPacket');

class WebSocketClient extends EventEmitter
{
	constructor(socket){
		super();
		this.socket = socket;
		listenPacket(socket, Packet);
		socket.on('packet', data => {
			if(data == null)return;
			let evt = (typeof data == 'number') ? 'close' : 'message';
			this.emit(evt, data);
		});
	}

	send(data){
		this.socket.write(encode(data));
	}
}

module.exports = WebSocketClient;