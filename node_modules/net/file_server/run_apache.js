'use strict';

const {extname, basename} = require('path');
const {HttpServer, StaticFile, StaticDirectory} = require('../HttpServer');

const root = '';
HttpServer({}, [
	StaticDirectory(root, true, function(name){
		return `<meta charset="utf-8"><style>@media(max-device-width:800px){a{font-size:4em;}}a,img{display:block;}body{display:flex;flex-direction:column;}</style>`;
	}, function(){
		const imgExt = ['.jpg', '.png'];
		return href => {
			const name = basename(href);
			if(name == 'desktop.ini')return;
			if(imgExt.includes(extname(name)))
				return `<a href="${href}">${name}<img src="${href}"></a>`;
			const order = name.includes('.') ? -1 : -2;
			return `<a href="${href}" style="order:${order};">${name}</a>`;
		}
	}()),
	StaticFile(root),
]);
