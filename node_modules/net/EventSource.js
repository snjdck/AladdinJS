'use strict';

const http = require('http');

module.exports = (onConnect, port=80, host='0.0.0.0') => http.createServer((request, response) => {
	response.setHeader('Access-Control-Allow-Origin', '*');
	response.setHeader('Content-Type', 'text/event-stream');
	response.setHeader('Cache-Control', 'no-cache');
	onConnect(request, response);
}).on('listening', function(){
	console.log(this.address());
}).listen(port, host);
/*
fn((request, response) => {
	request.on('close', () => {
		console.log('client close');
		clearInterval(timer)
	})
	let i = 0
	const timer = setInterval(() => {
		console.log('send', i)
		response.write('data: hello ' + (i++) + '\n\n');
	}, 1000)
}, 3230)
//*/
