
const dgram = require('dgram');
const networkInterface = require('./networkInterface');
const machine_address = networkInterface();
const boardcast_address = machine_address.replace(/\d+$/, '255');

module.exports = function(port, onMessage){
	const client = dgram.createSocket('udp4').bind(port);
	const sendMsg = (msg, address=boardcast_address) => client.send(msg, port, address);
	const destroy = () => client.close();
	client.on('message', (msg, {address}) => onMessage.call(client, msg, address, address == machine_address));
	return {sendMsg, destroy};
}