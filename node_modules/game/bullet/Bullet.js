
const EventEmitter = require('events');

class Bullet extends EventEmitter
{
	constructor(){
		this.destroyCondition = [];
		this.firePosition = {x:0,y:0};
		this.position = {x:0,y:0};
		this.liveTime = 0;
		this.moveType = null;
	}

	testCondition(){
		return this.destroyCondition.find(v => v.onUpdate(this));
	}
}

class BulletManager
{
	constructor(){
		this.bulletList = new Set();
	}

	addBullet(bullet){
		this.bulletList.add(bullet);
	}

	removeBullet(bullet){
		this.bulletList.remove(bullet);
	}

	update(timeElapsed){
		for(let bullet of this.bulletList){
			bullet.moveType.move(bullet, timeElapsed);
			const condition = bullet.testCondition();
			if(!condition)continue;
			condition.onDestroyBullet(bullet);
		}
	}
}