
import compose from 'utils/function/compose';
import wrap from 'utils/function/wrap';

function applyMiddleware(...middlewareList)
{
	return createStore => (...args) => {
		const store = createStore(...args);
		const context = {
			getState: store.getState,
			dispatch: wrap(store.dispatch)
		};
		store.dispatch = compose(...middlewareList.map(fn => fn(context)))(store.dispatch);
		return store;
	};
}

export default applyMiddleware;