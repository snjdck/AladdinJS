'use strict';

const {readFileSync, writeFileSync} = require('fs');

/*
[Colon][Data Size][Start Address][Record Type][Data][Checksum]
[:][10][0000][00][0C9434000C944F000C944F000C944F00][4F]
Checksum = ~v[0:-1].reduce(add) + 1 & 0xFF
v.reduce(add) & 0xff == 0

‘00’ Data Record：数据记录
‘01’ End of File Record：文件结束记录
‘02’ Extended Segment Address Record：扩展段地址记录
‘03’ Start Segment Address Record：开始段地址记录
‘04’ Extended Linear Address Record：扩展线性地址记录
‘05’ Start Linear Address Record：开始线性地址记录

const parseHEX = data => Buffer.from(Array.from(data.trim()
	.split(/\s+/)
	.map(line => line.slice(9, -2))
	.join('')
	.match(/\w{2}/g),
	v => parseInt(v, 16)
));
//*/
const parseHEX = data => Buffer.from(data.trim()
	.split(/\s+/)
	.map(line => line.slice(9, -2))
	.join(''),
	'hex'
);

const cast = path => writeFileSync(path + '.raw', parseHEX(readFileSync(path, 'utf8')));

process.argv.slice(2).forEach(cast);
