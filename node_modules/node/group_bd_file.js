
const {basename, extname, join} = require('path');
const {renameSync, existsSync, copyFileSync, unlinkSync, statSync, mkdirSync} = require('fs');
const {walkDir} = require('./fs');

function cast(dir, countPerDir){
	const list = [];
	walkDir(dir, path => list.push(path));
	const dirCount = Math.ceil(list.length / countPerDir);
	for(let i=0; i<dirCount; ++i){
		const subDir = join(dir, i.toString());
		mkdirSync(subDir);
		for(let file of list.slice(i * countPerDir, (i + 1) * countPerDir)){
			renameSync(file, join(subDir, basename(file)));
		}
	}
}

process.argv.slice(2).forEach(dir => cast(dir, 500));
