'use strict';

const {Resolver} = require('dns').promises;

function newResolver(host){
	const resolver = new Resolver();
	resolver.setServers([host]);
	return resolver;
}

const resolverList = [
	new Resolver(),
	newResolver('8.8.8.8'),
	newResolver('114.114.114.114'),
	newResolver('180.76.76.76'),
	newResolver('223.5.5.5'),
	newResolver('223.6.6.6'),
];

async function resolve(host){
	for(const resolver of resolverList){
		console.log('resolve', host, 'from', resolver.getServers()[0])
		const result = await resolver.resolve(host);
		if(result.length == 1 && result[0] == '127.0.0.1'){
			continue;
		}
		return result;
		//console.log(result);
	}
}

void async function(){
	console.log(await resolve('baidu.com'));
	console.log(await resolve('github.io'));
}();
