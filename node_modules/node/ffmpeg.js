'use strict';

const {execFileSync, execSync} = require('child_process');
const {extname, join, basename} = require('path');
const os = require('os');
const {readFileSync, writeFileSync, mkdtempSync, renameSync} = require('fs');
const {walkDir, clearFolderSync} = require('node/fs');



const getInfo = file => JSON.parse(execSync(`${ffprobe} -v quiet -of json -select_streams v -show_streams -show_entries format=duration,size -i ${JSON.stringify(file)}`));
const getDuration = file => Number(getInfo(file).format.duration);
function getAspect(file){
	const {width, height} = getInfo(file).streams[0];
	return width + 'x' + height;
}
function cut(oldFile, newFile, from, to){
	execSync(`${ffmpeg} -v quiet -i ${JSON.stringify(oldFile)} -ss ${from} -to ${to} -c copy ${JSON.stringify(newFile)}`);
}

const fileList = [];
walkDir(inputDir, file => {
	let path = outputDir + basename(file).replace(/ /g, "_");
	cut(file, path, 4, getDuration(file) - 4);
	fileList.push(path);
});
writeFileSync(outputTxt, fileList.map(v => `file ${v}`).join('\r\n'));
execSync(`${ffmpeg} -f concat -safe 0 -i ${outputTxt} -c copy ${outputWmv}`);
		 