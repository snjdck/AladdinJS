"use strict"

const PATTERN_FIELD		= /^\[(.*)\]/;
const PATTERN_KEY_VALUE	= /([^=]+)=(.*)/;

function decode(source){
	let result = {};
	let field, info;

	for(let line of source.split("\r\n")){
		info = PATTERN_KEY_VALUE.exec(line);
		if(info){
			field[info[1].trim()] = info[2].trim();
			continue;
		}
		info = PATTERN_FIELD.exec(line);
		if(info){
			let name = info[1].trim();
			if(!(name in result)){
				result[name] = {};
			}
			field = result[name];
		}
	}

	return result;
}

exports.decode = decode;