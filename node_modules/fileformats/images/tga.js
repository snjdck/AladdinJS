"use strict";

const {readColorData} = require("./utils");
/*
private function readType10(bitPerPixel:uint):void
		{
			var pixelCount:uint = bmd.width * bmd.height;
			var index:int = 0;
			
			var head:uint;
			var count:uint;
			var color:uint;
			
			while(index < pixelCount){
				head = ba.readUnsignedByte();
				if((head & 0x80) > 0){
					count = (head & 0x7F) + 1;
					color = readColor(bitPerPixel);
					while(count-- > 0){
						setPixelAtIndex(index++, color);
					}
				}else{
					count = head + 1;
					while(count-- > 0){
						setPixelAtIndex(index++, readColor(bitPerPixel));
					}
				}
			}
		}
*/
function deocde(bytes){
	let ba = new Uint8Array(bytes);

	var imageInfoSize = ba.readUInt8(0);
	var hasColorTable = ba.readUInt8(1);
	var imageType = ba.readUInt8(2);
	var px = ba.readUInt16LE(8);
	var py = ba.readUInt16LE(10);
	var width = ba.readUInt16LE(12);
	var height = ba.readUInt16LE(14);
	var bitPerPixel = ba.readUInt8(16);//8, 16, 24, 32
	var flags = ba.readUInt8(17);
	/*--head end--*/
	
	var right2left = ((flags >> 4) & 1) == 1;
	var bottom2top = ((flags >> 5) & 1) == 0;

	console.assert(imageType == 2);
	console.assert(bitPerPixel >= 24);
	return readColorData(ba, 18 + imageInfoSize, width, height, bitPerPixel, right2left, !bottom2top);
}

module.exports = deocde;