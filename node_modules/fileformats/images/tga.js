"use strict";

const assert = require("assert");
const ByteArray = require("../../utils/ByteArray");
const {readColorData} = require("./utils");
/*
private function readType10(bitPerPixel:uint):void
		{
			var pixelCount:uint = bmd.width * bmd.height;
			var index:int = 0;
			
			var head:uint;
			var count:uint;
			var color:uint;
			
			while(index < pixelCount){
				head = ba.readUnsignedByte();
				if((head & 0x80) > 0){
					count = (head & 0x7F) + 1;
					color = readColor(bitPerPixel);
					while(count-- > 0){
						setPixelAtIndex(index++, color);
					}
				}else{
					count = head + 1;
					while(count-- > 0){
						setPixelAtIndex(index++, readColor(bitPerPixel));
					}
				}
			}
		}
*/
function deocde(bytes){
	let ba = new ByteArray(bytes);

	var imageInfoSize = ba.readUInt8();
	var hasColorTable = ba.readBoolean();
	var imageType = ba.readUInt8();
	
	if(hasColorTable){
		var colorTableOffset = ba.readUInt16LE();
		var colorTableLength = ba.readUInt16LE();
		var colorType = ba.readUInt8();//16,24,32
	}else{
		ba.position += 5;
	}
	
	
	var px = ba.readUInt16LE();
	var py = ba.readUInt16LE();
	var width = ba.readUInt16LE();
	var height = ba.readUInt16LE();
	
	var bitPerPixel = ba.readUInt8();//8, 16, 24, 32
	var flags = ba.readUInt8();
	/*--head end--*/
	
	var right2left = ((flags >> 4) & 1) == 1;
	var bottom2top = ((flags >> 5) & 1) == 0;
	
	ba.position += imageInfoSize;

	assert(imageType == 2);
	assert(bitPerPixel >= 24);
	return readColorData(ba, width, height, bitPerPixel, right2left, !bottom2top);
}

module.exports = deocde;