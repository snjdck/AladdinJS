"use strict";

const assert = require("assert");
const ByteArray = require("../../utils/ByteArray");
const {readColorData} = require("./utils");

function deocde(bytes){
	let ba = new ByteArray(bytes);
	let right2left = false;
	let bottom2top = false;

	ba.position = 10;

	let dataOffset = ba.readUInt32LE();

	assert.equal(ba.readUInt32LE(), 40);

	let width = ba.readInt32LE();
	let height = ba.readInt32LE();

	if(height < 0){
		height = -height;
	}else{
		bottom2top = true;
	}

	ba.position += 2;
	let bitPerPixel = ba.readUInt16LE();//1,4,8,16,24,32
	let compression = ba.readUInt32LE();// 0(不压缩),1(BI_RLE8压缩类型)或2(BI_RLE4压缩类型)之一
	let imageSize = ba.readUInt32LE();
	
	ba.position = 54;//调色板,如果有
	assert(bitPerPixel >= 24 && compression == 0);

	ba.position = dataOffset;
	return readColorData(ba, width, height, bitPerPixel, right2left, !bottom2top);
}

module.exports = deocde;