"use strict";

const {readColorData} = require("./utils");

function deocde(bytes){
	let ba = new Uint8Array(bytes);
	let right2left = false;
	let bottom2top = false;

	let dataOffset = ba.readUInt32LE(10);

	console.assert(ba.readUInt32LE(14) == 40);

	let width = ba.readInt32LE(18);
	let height = ba.readInt32LE(22);

	if(height < 0){
		height = -height;
	}else{
		bottom2top = true;
	}

	let bitPerPixel = ba.readUInt16LE(28);//1,4,8,16,24,32
	let compression = ba.readUInt32LE(30);// 0(不压缩),1(BI_RLE8压缩类型)或2(BI_RLE4压缩类型)之一
	let imageSize = ba.readUInt32LE(34);
	
	//ba.position = 54;//调色板,如果有
	console.assert(bitPerPixel >= 8 && compression == 0);

	return readColorData(ba, dataOffset, width, height, bitPerPixel, right2left, !bottom2top);
}

module.exports = deocde;