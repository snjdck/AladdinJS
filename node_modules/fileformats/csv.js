"use strict"

function decode(source){
	let result = [];

	let line = [];
	let field = "";
	let isReadingString = false;

	for(let i=0, n=source.length; i<n; ++i){
		let char = source.charAt(i);
		if(isReadingString){
			if(char != '"'){
				field += char;
			}else if(i < n-1 && source.charAt(i+1) == '"'){
				field += char;
				++i;
			}else{
				isReadingString = false;
			}
		}else if(char == ',' || char == '\r'){
			line.push(field);
			field = "";
		}else if(char == '\n'){
			result.push(line);
			line = [];
		}else if(char == '"'){
			isReadingString = true;
		}else{
			field += char;
		}
	}

	return result;
}

function _parseV(item, keyList){
	let result = {};
	for(let [i, v] of item.entries()){
		if(!v)continue;
		result[keyList[i]] = v;
	}
	return result;
}

function parseV(itemList, keyList=0){
	if(typeof keyList == "number"){
		keyList = itemList.splice(keyList, 1)[0];
	}
	return itemList.map(item => _parseV(item, keyList));
}

function parseH(itemList){
	let result = {};
	for(let [i, v] of itemList.shift().entries()){
		if(i==0)continue;
		let info = {};
		result[v] = info;
		for(let item of itemList){
			if(!item[i])continue;
			info[item[0]] = item[i];
		}
	}
	return result;
}

