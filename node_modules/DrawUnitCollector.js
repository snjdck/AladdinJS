"use strict";

class DrawUnitCollector
{
	constructor(){
		this.drawUnitList = [];
		this.materialDict = new Map();
	}

	clear(){
		this.drawUnitList.length = 0;
	}

	addDrawUnit(drawUnit){
		this.drawUnitList.push(drawUnit);
	}

	draw(gl, camera){
		let {drawUnitList, materialDict} = this;
		if(drawUnitList.length <= 0){
			return;
		}
		for(let drawUnitList of materialDict.values()){
			drawUnitList.length = 0;
		}
		for(let drawUnit of drawUnitList){
			let materialType = drawUnit.material.constructor.name;
			if(materialDict.has(materialType)){
				materialDict.get(materialType).push(drawUnit);
			}else{
				materialDict.set(materialType, [drawUnit]);
			}
		}
		for(let drawUnitList of materialDict.values()){
			if(drawUnitList.length <= 0)continue;
			let {material} = drawUnitList[0];
			material.render(gl, camera, drawUnitList);
		}
	}
}

module.exports = DrawUnitCollector;