"use strict";

const WebGL = require('../WebGL');

class Filter2D
{
	draw(target){
		let {gl, render2d, renderStateStack, programMgr} = WebGL;
		render2d.submit();
		renderStateStack.save(gl.DRAW_FRAMEBUFFER_BINDING, gl.CURRENT_PROGRAM);

		let imageFrameBuffer = this.borrowFrameBuffer();
		target.onDraw();
		render2d.submit();

		programMgr.useProgram(this.shader);

		this.onDraw(imageFrameBuffer.colorBuffer);

		this.returnFrameBuffer(imageFrameBuffer);

		renderStateStack.load(gl.CURRENT_PROGRAM);
	}

	borrowFrameBuffer(){
		let {gl, renderTargetMgr} = WebGL;
		let frameBuffer = renderTargetMgr.getOut();
		frameBuffer.active();
		gl.clearColor(0, 0, 0, 0);
		gl.clear(gl.COLOR_BUFFER_BIT);
		return frameBuffer;
	}

	returnFrameBuffer(frameBuffer){
		let {renderTargetMgr} = WebGL;
		renderTargetMgr.putIn(frameBuffer);
	}

	onDraw(image){}
}

module.exports = Filter2D;