"use strict";

const WebGL = require('../WebGL');
const Filter2D = require('./Filter2D');
const {ProgramName} = require('../const');

class ColorMatrixFilter extends Filter2D
{
	constructor(){
		super();
		this.shader = ProgramName.filter2d_colormatrix;
		//this.matrix = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
		this.matrix = new Float32Array([0.3, 0.3, 0.3, 0, 0.59, 0.59, 0.59, 0, 0.11, 0.11, 0.11, 0, 0, 0, 0, 1]);
		this.offset = new Float32Array([0, 0, 0, 0]);
	}

	onDraw(image, address){
		let {gl, drawScreen, renderStateStack} = WebGL;
		renderStateStack.load(gl.DRAW_FRAMEBUFFER_BINDING);
		gl.bindTexture(gl.TEXTURE_2D, image);

		gl.uniformMatrix4fv(address.matrix, false, this.matrix);
		gl.uniform4fv(address.offset, this.offset);

		drawScreen();
	}
}

module.exports = ColorMatrixFilter;