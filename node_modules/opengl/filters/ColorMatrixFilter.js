"use strict";

const WebGL = require('../WebGL');
const {ColorMatrixProgram} = require("../programs");
const Filter2D = require("./Filter2D");

class ColorMatrixFilter extends Filter2D
{
	constructor(){
		super();
		this.program = ColorMatrixProgram.new();
		//this.matrix = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
		this.matrix = new Float32Array([0.3, 0.3, 0.3, 0, 0.59, 0.59, 0.59, 0, 0.11, 0.11, 0.11, 0, 0, 0, 0, 1]);
		this.offset = new Float32Array([0, 0, 0, 0]);
	}

	onDraw(image){
		let {gl, util, renderStateStack} = WebGL;
		renderStateStack.load(gl.FRAMEBUFFER_BINDING);
		gl.bindTexture(gl.TEXTURE_2D, image);

		this.program.updateUniform(gl, this.matrix, this.offset);

		util.drawScreen();
	}
}

module.exports = ColorMatrixFilter;