
const WebGL = require('../WebGL');
const VertexArray = require('./VertexArray');

class MeshVertexArray extends VertexArray
{
	static new(subMesh){
		let vao = subMesh.__vao__;
		if(!vao){
			vao = new this(subMesh);
			subMesh.__vao__ = vao;
		}
		return vao;
	}

	constructor(subMesh){
		super();
		this.subMesh = subMesh;
		this.bindCount = subMesh.bindCount;
		this.boneData = subMesh.boneData;
		this.boneCount = subMesh.boneCount;
		this.maxCountPerDraw = Math.floor(1024 / subMesh.boneCount);
	}

	onCreate(gl){
		const {vertexData, indexData} = this.subMesh;
		super.onCreate(gl, vertexData, indexData);
		this.subMesh.onCreateVAO(gl);
	}

	draw(instanceCount=1){
		let {gl} = WebGL;
		this.subMesh.onDraw(gl, instanceCount);
	}
}

module.exports = MeshVertexArray;