"use strict";

const WebGL = require('../WebGL');
const {TextureRenderTarget} = require("../rendertargets");
const ObjectCache = require("utils/ObjectCache");

class RenderTargetManager
{
	constructor(){
		let {width, height} = WebGL;
		this.cache = new ObjectCache(TextureRenderTarget, null, [width, height]);
	}

	getOut(){
		return this.cache.getOut();
	}

	putIn(renderTarget){
		this.cache.putIn(renderTarget);
	}

	putAllIn(){
		this.cache.putAllIn();
	}

	borrowFrameBuffer(){
		let {gl} = WebGL;
		let frameBuffer = this.getOut();
		frameBuffer.active();
		gl.clearBufferfv(gl.COLOR, 0, zero);
		return frameBuffer;
	}

	returnFrameBuffer(frameBuffer){
		this.putIn(frameBuffer);
	}
}

const zero = new Float32Array(4);

module.exports = RenderTargetManager;
