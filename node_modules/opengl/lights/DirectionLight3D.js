"use strict";

const {DepthRenderTarget} = require("../rendertargets");
const Light3D = require("./Light3D");
const {Camera3D, Lens} = require("../cameras");
const {DrawMode} = require("../renderers");

class DirectionLight3D extends Light3D
{
	constructor(){
		super();

		this.w = 2048;
		this.h = 2048;

		let lens = Lens.OrthoLH(this.w, this.h, -1000, 1000);
		let camera = new Camera3D(lens);
		let rotation = camera.rotation;
		rotation.rotateAxisX(120 * Math.PI / 180);
		rotation.rotateAxisZ(-90 * Math.PI / 180);
		camera.rotation = rotation;
		this.camera = camera;
		this.shadowRenderTarget = new DepthRenderTarget(this.w, this.h);
	}

	drawShadowMap(gl, root){
		this.shadowRenderTarget.active(gl);
		gl.clear(gl.DEPTH_BUFFER_BIT);
		gl.viewport(0, 0, this.w, this.h);
		this.camera.render(root, gl, DrawMode.ShadowMap);
	}
}

module.exports = DirectionLight3D;