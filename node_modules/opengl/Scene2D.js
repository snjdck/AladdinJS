'use strict';

const WebGL = require('./WebGL');
const DisplayObject2D = require('./DisplayObject2D');
const traverseTree = require('utils/traverseTree');

class Scene2D
{
	constructor(width, height){
		this.root = new DisplayObject2D();
		this.root._scene = this;
		this.width = width;
		this.height = height;
	}

	update(){
		this.root.onUpdate();
	}

	draw(mode){
		let {render2d} = WebGL;
		render2d.mode = mode;
		render2d.invalidate();
		traverseTree.call(mode, this.root, this.onDraw);
		render2d.submit();
	}

	onDraw(item){
		if(!item.visible)return true;
		const {filter, onDraw} = item;
		if(this){
			if(onDraw)onDraw.call(item, this);
			return;
		}
		if(filter)filter.onDrawBegin(item);
		if(onDraw)onDraw.call(item);
		return filter && filter.onDrawEnd;
	}
}

module.exports = Scene2D;
