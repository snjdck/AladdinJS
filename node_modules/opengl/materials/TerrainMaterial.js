"use strict";

const Material = require("./Material");
const {RenderState} = require("../renderers");
const WebGL = require('../WebGL');
const {ProgramName} = require('../const');

class TerrainMaterial extends Material{
	constructor(texture){
		super(ProgramName.terrain);
		this.texture = texture;
		this.renderState = RenderState.Texture;
	}

	onDraw(drawUnit, index, batchIndex){
		if(index == 0 && batchIndex == 0){
			let {gl} = WebGL;
			let {vao} = drawUnit;
			let program = gl.getParameter(gl.CURRENT_PROGRAM);
			gl.uniform2i(gl.getUniformLocation(program, 'vertexCount'), vao.vertexCountX, vao.vertexCountY);
			gl.uniform1f(gl.getUniformLocation(program, 'tileSize'), drawUnit.size);
			gl.uniform1f(gl.getUniformLocation(program, 'uvScale'), drawUnit.uvScale);
			gl.bindTexture(gl.TEXTURE_2D_ARRAY, this.texture);
		}
	}
}

module.exports = TerrainMaterial;