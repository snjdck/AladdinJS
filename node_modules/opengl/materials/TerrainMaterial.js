"use strict";

const Material = require("./Material");
const {RenderState} = require("../renderers");
const WebGL = require('../WebGL');
const UniformBlockIndex = require("../const/UniformBlockIndex");

class TerrainMaterial extends Material{
	constructor(texture){
		super("terrain/");
		this.texture = texture;
		this.renderState = RenderState.Texture;
	}

	onActiveUniform(camera, program){
		let {render3d:{uniformBuffer}} = WebGL;

		uniformBuffer.active();
		camera.mvpUniformBuffer.active(UniformBlockIndex.MVP_BLOCK);
		
		//gl.activeTexture(gl.TEXTURE0);
		//gl.uniform1i(gl.getUniformLocation(program, "sampler0"), 0);
	}

	onActiveVAO(drawUnit){
		let {render3d:{uniformBuffer}} = WebGL;
		uniformBuffer.setFloats(1, drawUnit.size);
	}

	onDraw(uniformBuffer, drawUnit, index){
		uniformBuffer.setFloats(4 + index * 4, drawUnit.tileX, drawUnit.tileY);
	}
}

module.exports = TerrainMaterial;