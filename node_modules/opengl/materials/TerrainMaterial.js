"use strict";

const Material = require("./Material");
const {RenderState} = require("../renderers");
const WebGL = require('../WebGL');
const {ProgramName} = require('../const');

class TerrainMaterial extends Material{
	constructor(texture){
		super();
		this.texture = texture;
		this.renderState = RenderState.Texture;
	}
}

Object.defineProperty(TerrainMaterial, 'shader', {value: ProgramName.terrain});

TerrainMaterial.bindTexture = (gl, texture) => gl.bindTexture(gl.TEXTURE_2D_ARRAY, texture);
TerrainMaterial.onDrawBatch = function(drawUnitList, offset, instanceCount, batchIndex){
	const {address} = this;
	let drawUnit = drawUnitList[offset];
	let {gl} = WebGL;
	let {vao} = drawUnit;
	gl.uniform2i(address.vertexCount, vao.vertexCountX, vao.vertexCountY);
	gl.uniform1f(address.tileSize, drawUnit.size);
	gl.uniform1f(address.uvScale, drawUnit.uvScale);
}

module.exports = TerrainMaterial;