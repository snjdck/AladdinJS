"use strict";

const Material = require("./Material");
const {RenderState} = require("../renderers");
const WebGL = require('../WebGL');

class DepthMaterial extends Material{
	static new(){
		return instance;
	}

	constructor(){
		super("shader3d&depth");
		this.texture = null;
		this.renderState = RenderState.TextureHitTest;
	}

	onActiveUniform(camera, program){
		let {render3d:{uniformBuffer}} = WebGL;

		uniformBuffer.active();

		uniformBuffer.setFloatv(0, camera.lens);
		camera.worldTransformInvert.copyToArray(uniformBuffer.floatView, 16);
		uniformBuffer.setFloatv(28, camera.rect);
	}

	onActiveVAO({vao:{bindCount, boneCount}}){
		let {render3d:{uniformBuffer}} = WebGL;
		uniformBuffer.setInts(25, bindCount, boneCount);
	}

	onDraw(uniformBuffer, {boneMatrixList}, index){
		uniformBuffer.setFloatv(32 + index * boneMatrixList.length, boneMatrixList);
	}
}

const instance = new DepthMaterial();

module.exports = DepthMaterial;