'use strict';

class BitmapQueue
{
	constructor(keyFn){
		this.keyFn = keyFn;
		this.currentTexture = null;
		this.currentSet = null;
		this.queue = [];
	}

	clear(){
		this.currentTexture = null;
		this.currentSet = null;
		this.queue.length = 0;
	}

	add(target){
		const texture = this.keyFn(target);
		if(this.currentTexture != texture){
			this.currentTexture = texture;
			this.currentSet = [];
			this.queue.push(this.currentSet);
		}
		this.currentSet.push(target);
	}

	draw(fn, self){
		this.queue.forEach(fn, self);
		return this;
	}
}

module.exports = BitmapQueue;
